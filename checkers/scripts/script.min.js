"use strict";function _inherits(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function setupBoard(n,t){markupBoard(n);t.position.forEach(function(n,t){$("#"+t).addClass(n.colorClass).addClass(n.kindClass)});t.onSet(function(n,t){$("#"+t).addClass(n.colorClass).addClass(n.kindClass)});t.onDelete(function(n,t){$("#"+t).removeClass(n.colorClass).removeClass(n.kindClass)})}function cleanupBoard(n){n.offSet(function(n,t){$("#"+t).addClass(n.colorClass).addClass(n.kindClass)});n.offDelete(function(n,t){$("#"+t).removeClass(n.colorClass).removeClass(n.kindClass)})}function markupBoard(n){var t=$('<div class="last-row"/>').appendTo(n),i;for(appendLetterRow(t),i=8;i>0;i--)t=$('<div class="row"/>').appendTo(n),appendCellRow(t,i);t=$('<div class="zero-row"/>').appendTo(n);appendLetterRow(t)}function appendLetterRow(n){$('<div class="corner">&nbsp;<\/div>').appendTo(n);for(var t=97;t<105;t++)$('<div class="letter" />').appendTo(n).text(String.fromCharCode(t));$('<div class="corner">&nbsp;<\/div>').appendTo(n)}function appendCellRow(n,t){var i,r;for($('<div class="digit" />').appendTo(n).text(t),i=97;i<105;i++)r=String.fromCharCode(i)+t,$("<div />",{id:r,title:r,"class":"cell"}).appendTo(n);$('<div class="digit" />').appendTo(n).text(t)}var _get=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}},_createClass=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),Cell=function(){function n(t,i){_classCallCheck(this,n);this.row=t;this.column=i}return _createClass(n,[{key:"cellId",get:function(){return String.fromCharCode(97+this.column)+String.fromCharCode(49+this.row)}}],[{key:"fromId",value:function(t){return new n(t.charCodeAt(1)-49,t.charCodeAt(0)-97)}}]),n}(),Piece=function(){function n(t,i,r,u){_classCallCheck(this,n);this.kind=t;this.white=i;this.row=r;this.column=u}return _createClass(n,[{key:"canMove",value:function(){return!1}},{key:"findCapture",value:function(){return null}},{key:"canCapture",value:function(){return!1}},{key:"isSelectableForJump",value:function(){return!1}},{key:"isSelectableToMove",value:function(){return!1}},{key:"move",value:function(n,t){return this.row=t.row,this.column=t.column,this}},{key:"colorClass",get:function(){return this.white?"white":"black"}},{key:"kindClass",get:function(){return null}}]),n}(),Man=function(n){function t(n,i,r){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,1,n,i,r)}return _inherits(t,n),_createClass(t,[{key:"canMove",value:function(n){return n.row-this.row==(this.white?1:-1)&&Math.abs(n.column-this.column)==1}},{key:"findCapture",value:function(n,t){if(Math.abs(t.row-this.row)==2&&Math.abs(t.column-this.column)==2){var u=(t.row+this.row)/2,f=(t.column+this.column)/2,e=new Cell(u,f),i=e.cellId,r=n.getPiece(i);if(r!=null&&this.canCapture(r))return i}return null}},{key:"canCapture",value:function(n){return this.white!=n.white&&Math.abs(n.row-this.row)==1&&Math.abs(n.column-this.column)==1}},{key:"isSelectableForJump",value:function(n){var t;return this.row>1&&(this.column>1&&(t=n.getCellPiece(this.row-1,this.column-1),t!=null&&this.canCapture(t)&&n.getCellPiece(this.row-2,this.column-2)==null)||this.column<n.size-2&&(t=n.getCellPiece(this.row-1,this.column+1),t!=null&&this.canCapture(t)&&n.getCellPiece(this.row-2,this.column+2)==null))?!0:this.row<n.size-2&&(this.column>1&&(t=n.getCellPiece(this.row+1,this.column-1),t!=null&&this.canCapture(t)&&n.getCellPiece(this.row+2,this.column-2)==null)||this.column<n.size-2&&(t=n.getCellPiece(this.row+1,this.column+1),t!=null&&this.canCapture(t)&&n.getCellPiece(this.row+2,this.column+2)==null))?!0:!1}},{key:"isSelectableToMove",value:function(n){if(this.white){if(this.row<n.size-1&&(this.column>1&&n.getCellPiece(this.row+1,this.column-1)==null||this.column<n.size-1&&n.getCellPiece(this.row+1,this.column+1)==null))return!0}else if(this.row>0&&(this.column>0&&n.getCellPiece(this.row-1,this.column-1)==null||this.column<n.size-1&&n.getCellPiece(this.row-1,this.column+1)==null))return!0;return!1}},{key:"move",value:function(n,i){return i.row==(this.white?n.size-1:0)?new King(this.white,i.row,i.column):_get(Object.getPrototypeOf(t.prototype),"move",this).call(this,n,i)}},{key:"kindClass",get:function(){return"man"}}]),t}(Piece),King=function(n){function t(n,i,r){_classCallCheck(this,t);_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,2,n,i,r)}return _inherits(t,n),_createClass(t,[{key:"canMove",value:function(n){return Math.abs(n.row-this.row)==Math.abs(n.column-this.column)}},{key:"findCapture",value:function(n,t){var u=t.row-this.row,s=t.column-this.column,f,r,i,e,o;if(Math.abs(u)==Math.abs(s))for(f=Math.abs(u),r=new Cell(this.row,this.column),i=1;i<f;i++)if(r.row=this.row+(u>0?i:-i),r.column=this.column+(s>0?i:-i),e=r.cellId,o=n.getPiece(e),o!=null){if(i+1==f&&this.canCapture(o))return e;break}return null}},{key:"canCapture",value:function(n){return this.white!=n.white&&Math.abs(n.row-this.row)==Math.abs(n.column-this.column)}},{key:"isSelectableForJump",value:function(n){var r,t,i;if(this.row>1){if(this.column>1)for(r=Math.min(this.row,this.column)-1,t=1;t<r;t++)if(i=n.getCellPiece(this.row-t,this.column-t),i!=null){if(this.canCapture(i)&&n.getCellPiece(this.row-t-1,this.column-t-1)==null)return!0;break}if(this.column<n.size-2)for(r=Math.min(this.row,n.size-this.column-1)-1,t=1;t<r;t++)if(i=n.getCellPiece(this.row-t,this.column+t),i!=null){if(this.canCapture(i)&&n.getCellPiece(this.row-t-1,this.column+t+1)==null)return!0;break}}if(this.row<n.size-2){if(this.column>1)for(r=Math.min(n.size-this.row-1,this.column)-1,t=1;t<r;t++)if(i=n.getCellPiece(this.row+t,this.column-t),i!=null){if(this.canCapture(i)&&n.getCellPiece(this.row+t+1,this.column-t-1)==null)return!0;break}if(this.column<n.size-2)for(r=Math.min(n.size-this.row-1,n.size-this.column-1)-1,t=1;t<r;t++)if(i=n.getCellPiece(this.row+t,this.column+t),i!=null){if(this.canCapture(i)&&n.getCellPiece(this.row+t+1,this.column+t+1)==null)return!0;break}}return!1}},{key:"isSelectableToMove",value:function(n){return this.row<n.size-1&&(this.column>1&&n.getCellPiece(this.row+1,this.column-1)==null||this.column<n.size-1&&n.getCellPiece(this.row+1,this.column+1)==null)?!0:this.row>0&&(this.column>0&&n.getCellPiece(this.row-1,this.column-1)==null||this.column<n.size-1&&n.getCellPiece(this.row-1,this.column+1)==null)?!0:!1}},{key:"kindClass",get:function(){return"king"}}]),t}(Piece),Board=function(){function n(){var t=arguments.length<=0||arguments[0]===undefined?8:arguments[0],i=arguments.length<=1||arguments[1]===undefined?null:arguments[1];_classCallCheck(this,n);this.size=t;this.position=i!=null?i:n.defaultPosition(t);this._onSet=new Set;this._onDelete=new Set}return _createClass(n,[{key:"onSet",value:function(n){return this._onSet.add(n),this}},{key:"offSet",value:function(n){return this._onSet["delete"](n),this}},{key:"onDelete",value:function(n){return this._onDelete.add(n),this}},{key:"offDelete",value:function(n){return this._onDelete["delete"](n),this}},{key:"storePosition",value:function(){return Array.from(this.position.values())}},{key:"getCellPiece",value:function(n,t){var i=new Cell(n,t);return this.getPiece(i.cellId)}},{key:"findSelectableForJump",value:function(n){var i=this,t=[];return this.position.forEach(function(r,u){r.white==n&&r.isSelectableForJump(i)&&t.push(u)}),t}},{key:"countPieces",value:function(n){var t=0;return this.position.forEach(function(i){i.white==n&&t++}),t}},{key:"getPiece",value:function(n){return this.position.get(n)}},{key:"setPiece",value:function(n,t){var i=this.position.get(n);return this.position.set(n,t),this._onSet.forEach(function(i){return i(t,n)}),i}},{key:"deletePiece",value:function(n){var t=this.position.get(n);return t!=null&&(this.position["delete"](n),this._onDelete.forEach(function(i){return i(t,n)})),t}}],[{key:"defaultPosition",value:function(){for(var n,r=arguments.length<=0||arguments[0]===undefined?8:arguments[0],f=arguments.length<=1||arguments[1]===undefined?3:arguments[1],i=new Cell(0,0),u=new Map,t=0;t<f;t++)for(i.row=t,n=0;n<r;n++)(t+n&1)==0&&(i.column=n,u.set(i.cellId,new Man(!0,t,n)));for(t=r-f;t<r;t++)for(i.row=t,n=0;n<r;n++)(t+n&1)==0&&(i.column=n,u.set(i.cellId,new Man(!1,t,n)));return u}},{key:"loadPosition",value:function(){var r=arguments.length<=0||arguments[0]===undefined?[]:arguments[0],n=null,t=new Cell(0,0),i=new Map;return r.forEach(function(r){switch(r.kind){case 1:n=new Man(r.white,r.row,r.column);break;case 2:n=new King(r.white,r.row,r.column)}n!=null&&(t.row=r.row,t.column=r.column,i.set(t.cellId,n))}),i}}]),n}(),Game=function(){function n(t){_classCallCheck(this,n);this.finished=!1;this.result=0;this.whiteTurn=!0;this.selected=null;this.selectableForJump=null;this.board=t}return _createClass(n,[{key:"prepare",value:function(){this.selectableForJump==null&&(this.selectableForJump=this.board.findSelectableForJump(this.whiteTurn))}},{key:"tryToJump",value:function(n,t){var r=Cell.fromId(t),u=n.findCapture(this.board,r),i;return u!=null?(this.board.deletePiece(u),this.board.deletePiece(this.selected),i=n.move(this.board,r),this.board.setPiece(t,i),i.isSelectableForJump(this.board)?this.selected=t:(this.selected=null,this.selectableForJump=null,this.whiteTurn=!this.whiteTurn,this.board.countPieces(this.whiteTurn)==0&&(this.finished=!0,this.result=this.whiteTurn?-1:1)),!0):!1}},{key:"tryToMove",value:function(n,t){var i=Cell.fromId(t);return n.canMove(i)?(this.board.deletePiece(this.selected),this.board.setPiece(t,n.move(this.board,i)),this.selected=null,this.selectableForJump=null,this.whiteTurn=!this.whiteTurn,!0):!1}}]),n}();$(function(){var t=new Board,n=new Game(t);setupBoard($("#board"),t);$(".cell").click(function(){var r=n.selected,i,u;r==null?(n.prepare(),i=t.getPiece(this.id),i==null?alert("You have to select a piece"):i.white!=n.whiteTurn?alert("You have to select a "+(n.whiteTurn?"light":"dark")+" piece"):n.selectableForJump.length>0?n.selectableForJump.indexOf(this.id)>=0?(n.selected=this.id,$(this).addClass("selected")):alert("You have to select another piece to jump: "+n.selectableForJump):i.isSelectableToMove(t)?(n.selected=this.id,$(this).addClass("selected")):alert("You have to select another piece to move")):(i=t.getPiece(r),i==null?alert("Piece is not selected"):(u=t.getPiece(this.id),u==null?i.isSelectableForJump(t)?n.tryToJump(i,this.id)?($("#"+r).removeClass("selected"),n.selected!=null?$(this).addClass("selected"):n.finished&&alert("Game over: "+(n.result>0?"light":"dark")+" won")):alert("You can not jump to this cell on the board"):n.tryToMove(i,this.id)?($("#"+r).removeClass("selected"),n.selected!=null&&$(this).addClass("selected")):alert("You can not move to this cell on the board"):alert("You have to move to unoccupied square on the board")))})});